box: ruby
build:
  steps:
    - script:
        name: Install Node.js
        code: apt-get install -y nodejs

    - script:
      name: Bundler setting
      code: bundle config build.nokogiri --use-system-libraries

    - bundle-install

    - script:
      name: Middleman build
      code: bundle exec middleman build --verbose

deploy:
  steps:
    - s3sync:
        source_dir: build/
        delete-removed: true
        bucket-url: $AWS_BUCKET_URL
        key-id: $AWS_ACCESS_KEY_ID
        key-secret: $AWS_SECRET_ACCESS_KEY